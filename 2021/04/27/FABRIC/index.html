<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="author" content="John Doe"><meta name="renderer" content="webkit"><meta name="copyright" content="John Doe"><meta name="keywords" content="Hexo"><meta name="description" content=""><meta name="Cache-Control" content="no-cache"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>FABRIC · Nainaiguan's Blog</title><link rel="stylesheet" href="/css/style.css?v=2018.7.9"><link rel="stylesheet" href="/css/animation.css?v=2018.7.9"><link rel="icon" href="/img/assets/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.6"><!-- scripts--><script>(function( w ){
  "use strict";
  // rel=preload support test
  if( !w.loadCSS ){
    w.loadCSS = function(){};
  }
  // define on the loadCSS obj
  var rp = loadCSS.relpreload = {};
  // rel=preload feature support test
  // runs once and returns a function for compat purposes
  rp.support = (function(){
    var ret;
    try {
      ret = w.document.createElement( "link" ).relList.supports( "preload" );
    } catch (e) {
      ret = false;
    }
    return function(){
      return ret;
    };
  })();

  // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
  // then change that media back to its intended value on load
  rp.bindMediaToggle = function( link ){
    // remember existing media attr for ultimate state, or default to 'all'
    var finalMedia = link.media || "all";

    function enableStylesheet(){
      link.media = finalMedia;
    }

    // bind load handlers to enable media
    if( link.addEventListener ){
      link.addEventListener( "load", enableStylesheet );
    } else if( link.attachEvent ){
      link.attachEvent( "onload", enableStylesheet );
    }

    // Set rel and non-applicable media type to start an async request
    // note: timeout allows this to happen async to let rendering continue in IE
    setTimeout(function(){
      link.rel = "stylesheet";
      link.media = "only x";
    });
    // also enable media after 3 seconds,
    // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
    setTimeout( enableStylesheet, 3000 );
  };

  // loop through link elements in DOM
  rp.poly = function(){
    // double check this to prevent external calls from running
    if( rp.support() ){
      return;
    }
    var links = w.document.getElementsByTagName( "link" );
    for( var i = 0; i < links.length; i++ ){
      var link = links[ i ];
      // qualify links to those with rel=preload and as=style attrs
      if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
        // prevent rerunning on link
        link.setAttribute( "data-loadcss", true );
        // bind listeners to toggle media back
        rp.bindMediaToggle( link );
      }
    }
  };

  // if unsupported, run the polyfill
  if( !rp.support() ){
    // run once at least
    rp.poly();

    // rerun poly on an interval until onload
    var run = w.setInterval( rp.poly, 500 );
    if( w.addEventListener ){
      w.addEventListener( "load", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    } else if( w.attachEvent ){
      w.attachEvent( "onload", function(){
        rp.poly();
        w.clearInterval( run );
      } );
    }
  }


  // commonjs
  if( typeof exports !== "undefined" ){
    exports.loadCSS = loadCSS;
  }
  else {
    w.loadCSS = loadCSS;
  }
}( typeof global !== "undefined" ? global : this ) );</script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" defer></script><script src="/js/main.js?v=2018.7.9" defer></script><!-- fancybox--><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script><!-- busuanzi--><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><section class="profile-close" id="cxo-profile"><div class="profile-avatar"><i class="fa fa-caret-left"></i><img src="/img/assets/cat.png"></div><!--.profile-saying
  i.fa.fa-comment
  .saying--><div class="cxo-profile-inner"><div class="profile-name">nainaiguan</div><div class="profile-signature">for me</div><div class="friends"><div>FRIENDS</div><span><a href="//github.com/nainaiguan" target="_black">friendA</a></span></div><div class="read-progress"></div></div></section><header id="cxo-intro" style="height: 70vh;background-image: url(/img/intro/index-bg.png);"><nav id="cxo-intro-nav"><section><div class="intro-nav-title"><a href="/">Nainaiguan's Blog</a></div><div class="intro-nav-label-box"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div><i class="fa fa-bars intro-nav-menu"><div class="intro-nav-drop"><a href="/">Home</a><a href="/about/">About</a><a href="/archives/">Archives</a><a href="/tags/">Tags</a></div></i><div class="clear"></div></section></nav><h1 class="post-title">FABRIC</h1><div class="post-intros"><div class="post-intro-meta"><span class="post-intro-time"><i class="post-intro-calendar fa fa-calendar"></i><span>2021-04-27</span></span></div></div></header><article class="cxo-up" id="cxo-content-outer"><section id="cxo-content-inner"><article class="article-entry" id="post"><h1 id="How-to-build-Fabric-Network-on-four-servers"><a href="#How-to-build-Fabric-Network-on-four-servers" class="headerlink" title="How to build Fabric Network on four servers."></a>How to build Fabric Network on four servers.</h1><p>The whole network includes an orderer and two peers belonging to two different organizations. In this blog, we put the orderer on one server, the cli, ca_orderer, ca_org1 and ca_org2 on one server and two organizations on another two servers. Here, we use debian10.7 as the operating system. This OS should include python 3.</p>
<p><strong><u>Tips: All the paths in this blog are just examples. Please enter your own paths in order to avoid mistakes!!!!!</u></strong></p>
<h3 id="TO-BEGIN-WITH-BUILD-THE-ENVIRONMENT"><a href="#TO-BEGIN-WITH-BUILD-THE-ENVIRONMENT" class="headerlink" title="TO BEGIN WITH, BUILD THE ENVIRONMENT"></a>TO BEGIN WITH, BUILD THE ENVIRONMENT</h3><p>We need docker, docker-compose, GO lang. These three are of necessity. If you want to compile with java, install your jdk(please notice the version you need), gradle, etc. And if you decide to compile with javascript, it is a good choice to install npm and nodejs. Anyway, it’s up to you. </p>
<p>Here are the steps.</p>
<p>Uninstall old versions of docker. (we usually call them docker, docker.io or docker-engine)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>

<p>Update the apt index</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>Install docker(install apt dependency and get repository with HTTPS)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg2 \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure>

<p>Add the official key</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<p>Make sure that you have had the key with fingerprint</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br><span class="line">//you will see the following text <span class="keyword">if</span> succeed</span><br><span class="line">pub   4096R/0EBFCD88 2017-02-22</span><br><span class="line">      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88</span><br><span class="line">uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;</span><br><span class="line">sub   4096R/F273FCD8 2017-02-22</span><br></pre></td></tr></table></figure>

<p>Update the apt index</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>Install the latest Docker-Engine-Community and containerd.io</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p>Check if the install is successful</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>make sure that you have add docker to the user group</strong></p>
</blockquote>
<p>Install docker (we use 1.24.1 as an example)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>Give executive authority to docker-compose</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>Check if you have succeeded</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>make sure you have given the executive authority!</strong></p>
</blockquote>
<p>Download go.tar with wget and url(here we use the version of 1.13.4)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.google.com/go/go1.13.4.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>

<p>Unzip and move go file to <strong>/usr/local</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf go1.13.4.linux-amd64.tar.gz &amp;&amp; mv go /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>Set environment variables</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">add the following text between <span class="string">&quot;//&quot;</span></span><br><span class="line">//</span><br><span class="line"><span class="built_in">export</span> GOROOT=/usr/<span class="built_in">local</span>/go</span><br><span class="line"><span class="built_in">export</span> GOPATH=/home/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/go/bin</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>Check if you have succeeded</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>

<p><strong>Now, you have succeeded in installing docker, docker-compose and GO lang! Choose your compile environment and install as you like. You have quite a lot of choices, but remember that you should have at least one compile environment(Java,javascript…..).</strong></p>
<h3 id="GIT-CLONE-THE-OPEN-SOURCE-OF-FABRIC-AND-PULL-THE-IMAGES"><a href="#GIT-CLONE-THE-OPEN-SOURCE-OF-FABRIC-AND-PULL-THE-IMAGES" class="headerlink" title="GIT CLONE THE OPEN SOURCE OF FABRIC AND PULL THE IMAGES"></a>GIT CLONE THE OPEN SOURCE OF FABRIC AND PULL THE IMAGES</h3><p>Here in this blog, we use fabric 2.3.1.</p>
<p>Steps are as follows.</p>
<p>Git clone the open source of fabric</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/hyperledger/fabric.git</span><br></pre></td></tr></table></figure>

<p>If you are Chinese and you are downloading at a low speed. Try the following method.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com.cnpmjs.org/hyperledger/fabric.git</span><br></pre></td></tr></table></figure>

<p>Use bootstrap.sh to pull images under the root path</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/fabric/script</span><br><span class="line">mv bootstrap.sh ~</span><br><span class="line">./bootstrap.sh</span><br></pre></td></tr></table></figure>

<p>Also,if you are Chinese and you are downloading at a low speed. Try the following method.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ~/bootstrap.sh</span><br><span class="line">//use mirror site </span><br><span class="line">//you should add <span class="string">&quot;.cnpm.org&quot;</span> behind <span class="string">&quot;github.com&quot;</span> <span class="keyword">in</span> the url</span><br><span class="line">//you can also use vpn as well</span><br></pre></td></tr></table></figure>

<p>Set environment variables</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">add the following text between <span class="string">&quot;//&quot;</span></span><br><span class="line">//</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin:<span class="variable">$GOPATH</span>/bin:/root/fabric-samples/bin</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>If you are in China, get your accelerator address on <a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"> &#123;</span><br><span class="line"> <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;the accelerator address you get on the site above&quot;</span>]</span><br><span class="line"> &#125;</span><br><span class="line"> EOF</span><br><span class="line"> </span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>Congratulations! You have succeeded in the first step. You can now start your first fabric test-network. Read the official docs on the site <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/latest/getting_started_run_fabric.html">https://hyperledger-fabric.readthedocs.io/en/latest/getting_started_run_fabric.html</a> to learn more about fabric.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/fabric-samples/test-network</span><br><span class="line"></span><br><span class="line">./network.sh up createChannel -c mychannel -ca &amp;&amp; ./network.sh deployCC -ccn ChaincodeName -ccp ChaincodePath -ccl ChaincodeLanguage</span><br><span class="line"></span><br><span class="line">//here we run a java app as an example, you need gradle environment <span class="keyword">in</span> this step</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/fabric-samples/asset-transfer-basic/application-java</span><br><span class="line"></span><br><span class="line">gradle runapp</span><br><span class="line"></span><br><span class="line">//<span class="keyword">then</span> you will see the transaction details</span><br></pre></td></tr></table></figure>

<p><strong>Now you have succeeded in building the fabric network on a single server.</strong></p>
<h3 id="CHANGE-FROM-ONE-SERVER-TO-FOUR-SERVERS"><a href="#CHANGE-FROM-ONE-SERVER-TO-FOUR-SERVERS" class="headerlink" title="CHANGE FROM ONE SERVER TO FOUR SERVERS"></a>CHANGE FROM ONE SERVER TO FOUR SERVERS</h3><p>If you have read the <strong>network.sh</strong> line by line and understood each step written in the script. Just go ahead. If you haven’t, stop right here and read the script quite carefully and you will learn a lot.</p>
<p>Now, the first step is that you must check the environment on all the four servers and make sure they are all the same. </p>
<p><strong>Premise:</strong></p>
<p><strong>cli, ca_orderer, ca_org1, ca_org2 on server0</strong></p>
<p><strong>orderer on server1</strong></p>
<p><strong>peer0.org1.example.com on server3</strong></p>
<p><strong>peer0.org2.example.com on server4</strong></p>
<p>After the preparation, let’s start.</p>
<p>Modify docker-compose-test-net.yaml and docker-compose-ca.yaml (you only need to modify the test-net.yaml on server1,2,3)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//<span class="built_in">cd</span> to the path of your files(test-network/docker)</span><br><span class="line">vim docker-compose-test-net.yaml</span><br><span class="line">//retain what you need and delete the spare(example:on server 3,you only need the config of org1)</span><br><span class="line">//now add the extra_host at the bottom(behind the ports and networks)</span><br><span class="line">//here is an example</span><br><span class="line"></span><br><span class="line">    extra_hosts:</span><br><span class="line">      - <span class="string">&quot;example.com:ip&quot;</span></span><br><span class="line">      - <span class="string">&quot;orderer.example.com:ip&quot;</span></span><br><span class="line">      - <span class="string">&quot;peer0.org1.example.com:ip&quot;</span></span><br><span class="line">      - <span class="string">&quot;peer0.org2.example.com:ip&quot;</span></span><br><span class="line">      </span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//<span class="built_in">cd</span> to the path of your files(fabric-samples/docker)</span><br><span class="line">vim docker-compose-ca.yaml</span><br><span class="line">//now add the extra_host at the bottom(behind the ports and networks)</span><br><span class="line">//here is an example</span><br><span class="line"></span><br><span class="line">    extra_hosts:</span><br><span class="line">      - <span class="string">&quot;example.com:ip&quot;</span></span><br><span class="line">      - <span class="string">&quot;orderer.example.com:ip&quot;</span></span><br><span class="line">      - <span class="string">&quot;peer0.org1.example.com:ip&quot;</span></span><br><span class="line">      - <span class="string">&quot;peer0.org2.example.com:ip&quot;</span></span><br><span class="line">      </span><br><span class="line">tips:there are three <span class="string">&quot;extra_hosts&quot;</span>(behind ca_org1,org2,orderer)</span><br></pre></td></tr></table></figure>

<p>Now, on server0.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//the path you operate under should be consistent with network.sh. Otherwise, more configs should be modified.</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> docker</span><br><span class="line">docker-compose -f docker-compose-ca.yaml up -d //build ca_org and ca_orderer</span><br></pre></td></tr></table></figure>

<p>Still on server0</p>
<p>Register orgs and orderer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network //the path <span class="built_in">where</span> the network.sh is</span><br><span class="line">. ./organizations/fabric-ca/registerEnroll.sh</span><br><span class="line">createOrderer //register orderer</span><br><span class="line">createOrg1 //register org1</span><br><span class="line">createOrg2 //register org2</span><br></pre></td></tr></table></figure>

<p>ccp-generate for org1 and org2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network</span><br><span class="line">./organizations/ccp-generate.sh</span><br></pre></td></tr></table></figure>



<p>These steps will add new files to the <strong>organizations</strong> folder(test-network/organizations). Now you should transfer organizations folder to server1,server2 and server3. Put them under the path of <strong>fabric-samples/test-network</strong>.</p>
<p>On server1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> docker</span><br><span class="line">docker-compose -f docker-compose-test-net.yaml up -d //build orderer</span><br><span class="line">docker ps //check <span class="keyword">if</span> orderer is built</span><br></pre></td></tr></table></figure>

<p>On server2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> docker</span><br><span class="line">docker-compose -f docker-compose-test-net.yaml up -d //build peer0.org1.example.com</span><br><span class="line">docker ps //check <span class="keyword">if</span> peer is built</span><br></pre></td></tr></table></figure>

<p>On server3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> docker</span><br><span class="line">docker-compose -f docker-compose-test-net.yaml up -d //build peer0.org2.example.com</span><br><span class="line">docker ps //check <span class="keyword">if</span> peer is built</span><br></pre></td></tr></table></figure>

<p>On server0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> docker</span><br><span class="line">docker-compose -f docker-compose-test-net.yaml up -d //build cli</span><br><span class="line">docker ps //check <span class="keyword">if</span> cli is build</span><br></pre></td></tr></table></figure>

<p>You can see docker logs to guarantee the connection between all the servers.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs <span class="string">&quot;id&quot;</span></span><br></pre></td></tr></table></figure>

<p>If everything is OK, let’s go ahead.</p>
<p>On server1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network //the path <span class="built_in">where</span> the network.sh is</span><br><span class="line">mkdir channel-artifacts //create a folder to save genesis block</span><br><span class="line"><span class="built_in">cd</span> configtx</span><br><span class="line">configtxgen -profile TwoOrgsApplicationGenesis -outputBlock ../channel-artifacts/channelname.block -channelID channelname //use your own channel name to generate genesis block</span><br><span class="line"><span class="built_in">cd</span> test-network</span><br><span class="line">. ./scripts/envVar.sh</span><br><span class="line">setGlobals 1 //setGlobals <span class="keyword">for</span> org1</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> test-network</span><br><span class="line"></span><br><span class="line">osnadmin channel join --channelID channelname --config-block ./channel-artifacts/channelname.block -o localhost:7053 --ca-file /test-network/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --client-cert test-network/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/tls/server.crt --client-key test-network/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/tls/server.key</span><br><span class="line">// haha, this is so long ! It is used to create the channel. Be careful! First, use your own channel name. Second, notice the path of all the three tls files. Even a little mistake is forbidden!</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Status 204 is excellent . When 1xx,3xx,4xx and 5xx occur(Something bad happened, you may check the former processes twice)</strong></p>
</blockquote>
<p>Then, we should transfer channel-artifacts folder to server0, server2 and server3. Put this folder under <strong>test-network</strong>.</p>
<p>Now, a channel has been built. Let’s join the peers to the channel.</p>
<p>On server2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network</span><br><span class="line">. ./script/envVar.sh</span><br><span class="line">setGlobals 1</span><br><span class="line">FABRIC_CFG_PATH=/root/fabric-samples/config peer channel join -b ./channel-artifacts/channelname.block</span><br><span class="line">//enter your own config path and channel-artifacts path!!!</span><br><span class="line">//join org1 to the channel</span><br></pre></td></tr></table></figure>

<p>On server3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network</span><br><span class="line">. ./script/envVar.sh</span><br><span class="line">setGlobals 2</span><br><span class="line">FABRIC_CFG_PATH=/root/fabric-samples/config peer channel join -b ./channel-artifacts/channelname.block</span><br><span class="line">//enter your own config path and channel-artifacts path!!!</span><br><span class="line">//join org2 to the channel</span><br></pre></td></tr></table></figure>

<p>All the peers have joined the channel you created. See the docker logs to check if there is something wrong.</p>
<p>On server0</p>
<p>Now, we should setAnchorPeer.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network</span><br><span class="line">docker <span class="built_in">exec</span> cli ./scripts/setAnchorPeer.sh 1 channelname</span><br><span class="line">docker <span class="built_in">exec</span> cli ./scripts/setAnchorPeer.sh 2 channelname</span><br></pre></td></tr></table></figure>

<p><strong>Check the docker logs on all servers. If there is no error, it means you have succeeded! CONGRATULATIONS!!!</strong></p>
<h3 id="DEPLOY-YOUR-CHAINCODE-ON-FOUR-SERVERS"><a href="#DEPLOY-YOUR-CHAINCODE-ON-FOUR-SERVERS" class="headerlink" title="DEPLOY YOUR CHAINCODE ON FOUR SERVERS"></a>DEPLOY YOUR CHAINCODE ON FOUR SERVERS</h3><p>It is quite easy to deploy your chaincode on only one server. Now I’ll show you how to deploy on four servers.</p>
<p>add hosts on server0.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">// add the following text</span><br><span class="line"></span><br><span class="line">ip        orderer.example.com</span><br><span class="line">ip        peer0.org1.example.com</span><br><span class="line">ip        peer0.org2.example.com</span><br><span class="line">ip        example.com</span><br><span class="line"></span><br><span class="line">//<span class="keyword">in</span> order to state ip</span><br></pre></td></tr></table></figure>

<p>Modify your deployCC.sh.</p>
<p>On server0</p>
<p>Because peers are not on server0, so you should enter –peerAddress and –tlsRootCertFiles behind most commands to state the address of your peers and tlsfiles paths on other servers.                                                                                                                                       For example,       –peerAddresses peer0.org1.example.com:7051 –tlsRootCertFiles /root/00/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt </p>
<blockquote>
<p>Quite a lot of sentences should be modified. This is an example and please enter you own file path.</p>
</blockquote>
<p>On server0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> test-network &amp;&amp; ./network.sh deployCC -ccn chaincodename -ccp chaincodepath -ccl chaincodelanguage</span><br></pre></td></tr></table></figure>



<h3 id="BUILD-YOUR-WALLET-AND-RUN-YOUR-APP"><a href="#BUILD-YOUR-WALLET-AND-RUN-YOUR-APP" class="headerlink" title="BUILD YOUR WALLET AND RUN YOUR APP"></a>BUILD YOUR WALLET AND RUN YOUR APP</h3><h4 id="Build-your-wallet"><a href="#Build-your-wallet" class="headerlink" title="Build your wallet"></a>Build your wallet</h4><p>modify <strong>connection-org1.json</strong> and <strong>connection-org1.yaml</strong> under                                                                                                                               <strong>test-network/organizations/peerOrganizations/org1.example.com</strong></p>
<p>modify <strong>connection-org2.json</strong> and <strong>connection-org2.yaml</strong> under                                                                                                                               <strong>test-network/organizations/peerOrganizations/org2.example.com</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change localhost into the ip of your own servers.</span><br></pre></td></tr></table></figure>

<p>modify your app</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aslocalhost:<span class="literal">false</span> //peers are on the different servers</span><br></pre></td></tr></table></figure>

<p><strong>Warning: you must have a wallet under the path of your app folder(consistent with the path of src)</strong></p>
<h4 id="Run-your-app"><a href="#Run-your-app" class="headerlink" title="Run your app"></a>Run your app</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> application-java</span><br><span class="line">gradle runapp</span><br><span class="line">//just an example, you can run your own app.</span><br></pre></td></tr></table></figure></article><!-- lincense--><div class="license-wrapper"><p> <span>Author:  </span><a href="https://nainaiguan.github.io">John Doe</a></p><p> <span>Link:  </span><a href="https://nainaiguan.github.io/2021/04/27/FABRIC/">https://nainaiguan.github.io/2021/04/27/FABRIC/</a></p><p> <span>Copyright:  </span><span></span></p></div><div class="post-paginator"><div class="clear"></div></div><div id="comment"></div></section></article><footer id="cxo-footer-outer"><div id="cxo-footer-inner"><p class="footer-container"><span>Site by </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span> | theme </span><a target="_blank" rel="noopener" href="https://github.com/Longlongyu/hexo-theme-Cxo"><span>Cxo</span></a></p><i class="fa fa-user"> </i><span id="busuanzi_value_site_uv"></span><span> | </span><i class="fa fa-eye"> </i><span id="busuanzi_value_site_pv"></span></div></footer><!-- catelog--><div class="toc-wrapper" style="top: 70vh;"><div class="toc-catalog"><i class="fa fa-list"> </i><span>CATALOG</span></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-build-Fabric-Network-on-four-servers"><span class="toc-number">1.</span> <span class="toc-text">How to build Fabric Network on four servers.</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TO-BEGIN-WITH-BUILD-THE-ENVIRONMENT"><span class="toc-number">1.0.1.</span> <span class="toc-text">TO BEGIN WITH, BUILD THE ENVIRONMENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GIT-CLONE-THE-OPEN-SOURCE-OF-FABRIC-AND-PULL-THE-IMAGES"><span class="toc-number">1.0.2.</span> <span class="toc-text">GIT CLONE THE OPEN SOURCE OF FABRIC AND PULL THE IMAGES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CHANGE-FROM-ONE-SERVER-TO-FOUR-SERVERS"><span class="toc-number">1.0.3.</span> <span class="toc-text">CHANGE FROM ONE SERVER TO FOUR SERVERS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DEPLOY-YOUR-CHAINCODE-ON-FOUR-SERVERS"><span class="toc-number">1.0.4.</span> <span class="toc-text">DEPLOY YOUR CHAINCODE ON FOUR SERVERS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BUILD-YOUR-WALLET-AND-RUN-YOUR-APP"><span class="toc-number">1.0.5.</span> <span class="toc-text">BUILD YOUR WALLET AND RUN YOUR APP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Build-your-wallet"><span class="toc-number">1.0.5.1.</span> <span class="toc-text">Build your wallet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Run-your-app"><span class="toc-number">1.0.5.2.</span> <span class="toc-text">Run your app</span></a></li></ol></li></ol></li></ol></li></ol></div><!-- top--><i class="fa fa-arrow-up close" id="go-up" aria-hidden="true"></i></body></html>